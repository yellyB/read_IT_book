
540(521p~)

### 리다이렉션 피할 수 없는 이유

- 신뢰할 수 있는 HTTP 트랜잭션의 수행
- 지연 최소화
- 네트워크 대역폭 절약

위 이유때문에 웹 콘텐츠는 여러 장소에 배포됨 → 한 곳 실패하면 다른 곳 이용 가능(신뢰성 개선) & 가까운 리소스 접근 가능(응답시간 줄여줌) & 목적지 서버 분산(네트워크 혼잡 줄임)

⇒ 리다이렉션은 최적의 분산된 콘텐츠를 찾는 기법의 집합

리다이렉션 장치들은 부하균형(load-balancing)포함한다. 왜냐? 부하를 공유하는 서버들 중 하나에게 전달되어야 하기 때문

### 리다이렉트 할 곳

- 웹 서버
    - IP별로 요청 다룸
    - 서버로의 리다이렉트는 휘발유를 찾는 모든 운전기사를 가장 가까운 주유소로
- 프락시
    - 프로토콜별로 요청 다룸
    - 프락시로의 리다이렉트는 주 진입로의 트래픽을 근처에 있는 지름길로 빨아들임

### 일반적인 리다이렉션 방법
| 메커니즘 | 어떻게 동작? | 재 라우팅의 근거 | 제약사항 |
| --- | --- | --- | --- |
| HTTP 리다이렉션 | 1. 우선 HTTP 요청은 콘텐츠 제공하기에 최적인 웹 서버 선택해줄 첫 번째 웹 서버로 간다.<br/>2. 그 웹 서버는 선택한 서버로의 HTTP 리다이렉트를 클라에게 보내줌.<br/>3. 클라는 선택된 서버에게 다시 요청 보냄 | - 라우드 로빈(돌아가면서 나눠주는 방식) 부하 균형<br/>- 회전 지연(latency) 최소화 <br/>- 최단 거리 선정 - 등등.. | - 느릴 수 있음.<br/>- 모든 트랜잭션이 추가 리다이렉트 단계를 포함하게 됨.<br/>- 반드시 첫 번째 웹 서버가 요청 부하를 다룰 수 있어야 함 |
| DNS 리다이렉션 | DNS 서버가 URL의 호스트 명에 대한 응답으로<br/>어떤 IP 주소를 사용할지 결정 | 위와 동일 | - DNS 서버를 설정할 필요가 있음 |
| 임의 캐스트 어드레싱 | 1. 여러 서버가 같은 IP 주소 사용.<br/>2. 각 서버는 백본 라우터인 척.<br/>3. 그 외 라우터들은 그 공유된 IP 주소로 향하는 패킷을 (가장 가까운 라우터로 보낸다고 믿으면서)가장 가까운 서버로 보냄 | - 내장된 최단거리 라우팅 기능 사용 | - 라우터 설정할 필요 있음<br/>- 주소 충돌 위험 있음<br/>- 라우팅이 바뀌고 커넥션과 연관된 패킷들이 다른 서버들로 보내진다면 수립된 TCP 커넥션이 깨질 수도 있음 |
| 아이피 맥(MAC) 포워딩 | 1. 스위치나 라우터가 패킷의 목적지 주소 읽음<br/>2. 패킷이 리다이렉트되어야 한다? 스위치는 그 패킷에게 서버나 프락시의 목적지 MAC 주소를 줌 | - 대역폭을 절약하고 QOS(Quality of Service, 서비스 품질)을 개선<br/>- 부하 균형 | - 서버나 프락시는 한 홉 거리에 있어야 함 |
| IP 주소 포워딩 | 1. 레이어 4 스위치(L4)는 패킷의 목적지 포트를 평가하고<br/>2. 리다이렉트 패킷의 IP 주소를<br/>프락시나 미러링된 서버의 IP 주소로 바꿈 | 위와 동일 | - 서버나 프락시가 클라이언트의 IP 주소를 잃어버릴 수 있음 |

### HTTP 리다이렉션

- 리다이렉팅 서버(요청을 처리하는 서버)는 부하가 가장 적은 서버를 찾아 거기로 보내줘야함. 서버가 광범위하게 분산되어 있다면 ‘최선의’ 가용한 서버를 결정하는것 더 어려워짐. (서버 부하뿐 아니라 인터넷상에서 브라우저-서버 거리도 계산에 넣어야 하기 때문)
- 장점: 리다이렉션를 하는 서버가 클라이언트 아이피 주소를 안다는 것 ⇒ 좀 더 정보에 근거해 선택할 수 있음
- 단점
    - 리다이렉트 결정하려면 원 서버는 상당히 많은 처리를 해야함. (때로는 페이지를 제공하는것과 같은 양의 처리가 필요해짐)
    - 페이지 접근할 때마다 두 번의 왕복 필요 → 사용자 더 오래 기다림
    - 리다이렉트 서버 고장? → 사이트도 고장

### 프락시 리다이렉션 방법

- 필요 이유
    - 보안상의 이유: 콘텐츠 접근할 때 프락시 통할 필요가 없음
    - 캐시된 콘텐츠를 받는것이 원 서버에 직접 가는것보다 빠를 때
- 클라이언트(웹 브라우저)들이 어떻게 프락시로 가는 길을 아는가?
    - 명시적 브라우저 설정
        - 브라우저에 있는 프락시 서버에 접촉하기 위한 (프락시 이름, 아이피 주소, 포트 번호) 풀다운 메뉴로 설정
        - 단점
            - 프락시 설정한 브라우저는 프락시 응답 없어도 원 서버와 접촉하지 않음 → 사용자는 접속 문제 경험
            - 네트워크 아키텍처 변경하면 그걸 모든 사용자에게 전파하는게 어려움 → 프락시 추가or제거 원함? 사용자들이 변경해야함
    - 프락시 자동 설정
        - 브라우저가 동적으로 자신을 설정
        - Proxy Auto-configuration, PAC 프로토콜이라고 불림
    - 웹 프락시 자동발견 프로토콜
        - Web Proxy Autodiscovery Protocol, WPAD
        - 브라우저가 근처의 브락시를 찾아내 사용할 수 있게 해줌

### 캐시 리다이렉션 방법

- WCCP 리다이렉션
    - WCCP: 캐시 조직 프로토콜
    - WCCP는 라우터들과 캐시들 사이의 대화를 관리 → 라우터가 캐시를 검사하고 특정 트래픽을 특정 캐시로 보낼 수 있게 해줌

### 인터넷 캐시 프로토콜

- ICP(인터넷 캐시 프로토콜)는 캐시들이 형제 캐시에서 일어난 캐시 적중을 찾아볼 수 있도록 해줌
- 캐시가 요청한 콘텐츠 갖고 있지 않다면?
- 근처 형제 캐시 중 갖고 있는애 있나 찾아보고, 만약 있다면 그 캐시에서 콘텐츠 가져옴
- ICP는 일종의 캐시 클러스터링 프로토콜이라 할 수 있음

### 캐시 배열 라우팅 프로토콜

- 배경
    - 프락시 서버는 사용자 요청을 가로채서 캐시 사본을 제공해 인터넷으로 향하는 트래픽 줄여줌. 그러나 대량 트래픽은 서버에 과도한 부하
    - ⇒ 프락시 서버 여러대로 늘림!
- 캐시 배열 라우팅 프로토콜(CARP)은 프락시 서버의 배열이 클라 입장에선 하나의 캐시처럼 보이도록 관리해주는 표준
- CARP는 ICP의 대안. (왜 대안이 되는지 궁금하면 554p)

### 하이퍼텍스트 캐싱 프로토콜

- 위에 ICP는 HTTP/0.9를 염두에 두고 설계(리소스 존재 여부 질의시 URL만 보)
- ⇒ HTTP 윗 버전의 많은 요청 헤더로 적중률 높이는데 도움 줌
